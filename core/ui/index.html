<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proprietary Protocol Fuzzer</title>
    <link rel="stylesheet" href="/ui-static/ui.css">

</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Proprietary Protocol Fuzzer</h1>
                <p class="subtitle">Portable & Extensible Network Protocol Security Testing Framework</p>
            </div>
            <button class="help-btn" onclick="showHelp()">Help & Guides</button>
        </header>

        <div id="messages"></div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard" onclick="switchTab('dashboard', this)">Dashboard</button>
            <button class="nav-tab" data-tab="plugin-debug" onclick="switchTab('plugin-debug', this)">Plugin Debugger</button>
            <button class="nav-tab" data-tab="oneoff-test" onclick="switchTab('oneoff-test', this)">One-Off Test</button>
            <button class="nav-tab" data-tab="correlation" onclick="switchTab('correlation', this)">Test Case Correlation</button>
            <!-- Documentation links are now in the Help & Guides modal -->
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="grid">
                <!-- Create Session -->
                <div class="card">
                    <h2>Create Fuzzing Session</h2>
                    <div class="card-description">
                        <strong>Step 1:</strong> Configure your fuzzing campaign. Select a protocol plugin,
                        specify the target host and port, then create a session. The fuzzer will use the
                        protocol's seed corpus and mutation strategies to generate test cases.
                    </div>
                    <form id="createSessionForm">
                        <div class="form-group">
                            <label for="protocol">
                                Protocol Plugin
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">
                                        Protocol plugins define the message structure (data model) and
                                        state machine for your target protocol. Custom plugins can be
                                        added to the core/plugins/ directory.
                                    </span>
                                </span>
                            </label>
                            <select id="protocol" required>
                                <option value="">Loading protocols...</option>
                            </select>
                            <div class="field-help">Choose a protocol that matches your target application</div>
                        </div>
                        <div class="form-group">
                            <label for="targetHost">
                                Target Host
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">
                                        Hostname or IP address of the target server.
                                        <br><br>
                                        <strong>Docker networking:</strong><br>
                                        ‚Ä¢ Use 'target' for SimpleTCP test server<br>
                                        ‚Ä¢ Use '172.17.0.1' (Linux) to reach host from container<br>
                                        ‚Ä¢ Use 'host.docker.internal' (Mac/Windows) to reach host<br>
                                        ‚Ä¢ 'localhost' only works if Core is NOT in Docker
                                    </span>
                                </span>
                            </label>
                            <input type="text" id="targetHost" value="target" required>
                            <div class="field-help">
                                <strong>Docker:</strong> Use 'target' for test server, or '172.17.0.1' to reach host.
                                <strong>Local:</strong> Use 'localhost' or IP address.
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="targetPort">
                                Target Port
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">
                                        TCP port number where your target service is listening.
                                        Common ports: 80 (HTTP), 443 (HTTPS), 9999 (SimpleTCP test server).
                                    </span>
                                </span>
                            </label>
                            <input type="number" id="targetPort" value="9999" required min="1" max="65535">
                            <div class="field-help">Port number between 1-65535</div>
                        </div>
                        <div class="form-group">
                            <label for="rateLimit">
                                Rate Limit (tests/second)
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">
                                        Maximum number of test cases to execute per second.
                                        Lower values give the target more time to process each input
                                        and make it easier to manually observe behavior.
                                        Set to 0 for unlimited (maximum throughput).
                                        Recommended: 10-100 for manual observation, 0 for maximum speed.
                                    </span>
                                </span>
                            </label>
                            <input type="number" id="rateLimit" value="0" min="0" max="10000" step="1">
                            <div class="field-help">0 = unlimited, 1-10000 = tests per second. Lower values help prevent dropped connections.</div>
                        </div>
                        <div class="form-group">
                            <label>
                                Mutation Mode
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">
                                        Controls how test cases are mutated:
                                        ‚Ä¢ Structure-Aware: Respects protocol grammar, auto-fixes lengths/checksums (~90% valid messages)
                                        ‚Ä¢ Byte-Level: Traditional bit/byte flips, finds parser bugs (~5% valid messages)
                                        ‚Ä¢ Hybrid: Mix of both (recommended) - gets deep code coverage + parser bugs
                                    </span>
                                </span>
                            </label>
                            <div style="margin-top: 10px;">
                                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="radio" name="mutationMode" value="hybrid" checked onchange="updateMutationModeUI()">
                                        <span>Hybrid (Recommended)</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="radio" name="mutationMode" value="structure_aware" onchange="updateMutationModeUI()">
                                        <span>Structure-Aware Only</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="radio" name="mutationMode" value="byte_level" onchange="updateMutationModeUI()">
                                        <span>Byte-Level Only</span>
                                    </label>
                                </div>
                            </div>
                            <div id="hybridWeightControl" style="margin-top: 15px; padding: 10px; background: #1a1a1a; border: 1px solid #444; border-radius: 4px;">
                                <label for="structureAwareWeight" style="display: block; margin-bottom: 8px;">
                                    Structure-Aware Weight: <span id="weightValue">70</span>%
                                    <span class="tooltip">
                                        <span class="help-icon">?</span>
                                        <span class="tooltiptext">
                                            Percentage of mutations that use structure-aware approach.
                                            Higher = more valid messages and deeper code coverage.
                                            Lower = more parser testing and edge case discovery.
                                        </span>
                                    </span>
                                </label>
                                <input type="range" id="structureAwareWeight" min="0" max="100" value="70"
                                       oninput="document.getElementById('weightValue').textContent = this.value"
                                       style="width: 100%; cursor: pointer;">
                                <div style="display: flex; justify-content: space-between; font-size: 11px; color: #888; margin-top: 5px;">
                                    <span>0% (All Byte-Level)</span>
                                    <span>50% (Balanced)</span>
                                    <span>100% (All Structure-Aware)</span>
                                </div>
                            </div>
                            <div class="field-help">Structure-aware mutations respect protocol grammar and auto-fix dependent fields</div>
                        </div>
                        <div class="form-group">
                            <label>
                                Mutation Strategies
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">
                                        Select which mutation strategies to enable for this session.
                                        Each strategy targets different vulnerability classes.
                                        See the "Mutation Guide" tab for detailed descriptions.
                                        All strategies are enabled by default.
                                    </span>
                                </span>
                            </label>
                            <div class="checkbox-group">
                                <div class="checkbox-item checked" onclick="toggleCheckbox(this, 'mutator_bitflip')">
                                    <input type="checkbox" id="mutator_bitflip" checked>
                                    <label for="mutator_bitflip">
                                        Bit Flip
                                        <span class="mutator-description">Flips individual bits (0‚Üí1, 1‚Üí0)</span>
                                    </label>
                                </div>
                                <div class="checkbox-item checked" onclick="toggleCheckbox(this, 'mutator_byteflip')">
                                    <input type="checkbox" id="mutator_byteflip" checked>
                                    <label for="mutator_byteflip">
                                        Byte Flip
                                        <span class="mutator-description">Replaces bytes with random values</span>
                                    </label>
                                </div>
                                <div class="checkbox-item checked" onclick="toggleCheckbox(this, 'mutator_arithmetic')">
                                    <input type="checkbox" id="mutator_arithmetic" checked>
                                    <label for="mutator_arithmetic">
                                        Arithmetic
                                        <span class="mutator-description">Integer overflow/underflow tests</span>
                                    </label>
                                </div>
                                <div class="checkbox-item checked" onclick="toggleCheckbox(this, 'mutator_interesting')">
                                    <input type="checkbox" id="mutator_interesting" checked>
                                    <label for="mutator_interesting">
                                        Interesting Values
                                        <span class="mutator-description">Boundary values (0, MAX_INT, etc.)</span>
                                    </label>
                                </div>
                                <div class="checkbox-item checked" onclick="toggleCheckbox(this, 'mutator_havoc')">
                                    <input type="checkbox" id="mutator_havoc" checked>
                                    <label for="mutator_havoc">
                                        Havoc
                                        <span class="mutator-description">Aggressive insert/delete/shuffle</span>
                                    </label>
                                </div>
                                <div class="checkbox-item checked" onclick="toggleCheckbox(this, 'mutator_splice')">
                                    <input type="checkbox" id="mutator_splice" checked>
                                    <label for="mutator_splice">
                                        Splice
                                        <span class="mutator-description">Combines different seed inputs</span>
                                    </label>
                                </div>
                            </div>
                            <div class="field-help">At least one mutator must be selected</div>
                        </div>
                        <button type="submit">Create Session</button>
                    </form>
                    <div class="field-help">
                        Need protocol blueprints, corpus previews, or readiness tips? Switch to the
                        <strong>Plugin Debugger</strong> tab to pick a protocol for deep inspection without
                        altering the session form.
                    </div>
                </div>

                <!-- System Status -->
                <div class="card">
                    <h2>System Status</h2>
                    <div class="card-description">
                        <strong>Live Metrics:</strong> Real-time overview of fuzzing activity.
                        Active sessions show running fuzzing campaigns. Seeds are test inputs from
                        protocol plugins. Findings are potential vulnerabilities detected by the oracles.
                    </div>
                    <div class="stats">
                        <div class="stat tooltip">
                            <div class="stat-value" id="activeSessions">0</div>
                            <div class="stat-label">Active Sessions</div>
                            <span class="tooltiptext">
                                Number of fuzzing sessions currently running. Each session targets
                                a specific protocol/host combination and continuously generates
                                test cases. Multiple sessions can run concurrently.
                            </span>
                        </div>
                        <div class="stat tooltip">
                            <div class="stat-value" id="totalSeeds">0</div>
                            <div class="stat-label">Corpus Seeds</div>
                            <span class="tooltiptext">
                                Number of seed inputs in the corpus. Seeds are valid protocol messages
                                used as starting points for mutation. More diverse seeds = better
                                code coverage. Seeds come from protocol plugins or manual uploads.
                            </span>
                        </div>
                        <div class="stat tooltip">
                            <div class="stat-value" id="totalFindings">0</div>
                            <div class="stat-label">Findings</div>
                            <span class="tooltiptext">
                                Number of potential vulnerabilities discovered. Findings include
                                crashes, hangs, and logical failures. Each finding is saved with
                                full reproduction data in data/crashes/ directory. Findings are
                                persisted across restarts.
                            </span>
                        </div>
                        <div class="stat tooltip">
                            <div class="stat-value" id="totalTests">0</div>
                            <div class="stat-label">Total Tests</div>
                            <span class="tooltiptext">
                                Cumulative test cases executed across all sessions. Each test sends
                                one mutated input to the target. Higher numbers indicate more
                                thorough fuzzing. Typical rate: 100-1000 tests/sec depending on
                                target response time.
                            </span>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Active Sessions -->
            <div class="card">
                <h2>Fuzzing Sessions</h2>
                <div class="card-description">
                    <strong>Session Management:</strong> Monitor and control your fuzzing campaigns. Each session
                    represents an independent fuzzing run targeting a specific protocol/host combination.
                    Click <strong>Start</strong> to begin sending mutated test cases to the target. The fuzzer
                    will continuously generate inputs using various mutation strategies and report any crashes,
                    hangs, or anomalies detected by the intelligent oracles.
                </div>
                <div id="sessions" class="loading">Loading sessions...</div>
            </div>
        </div>

        <!-- Plugin Debugger Tab -->
        <div id="plugin-debug-tab" class="tab-content">
            <div class="card">
                <h2>Protocol Plugin Debugger</h2>
                <div class="card-description">
                    Purpose-built diagnostics for protocol authors. Inspect protocol blueprints, seed
                    corpora, mutation previews, and readiness checks without cluttering the primary
                    session dashboard. Use the selector below to pick which plugin to visualize‚Äîthe
                    session form stays untouched.
                </div>
                <div class="form-group">
                    <label for="pluginDebugProtocol">
                        Protocol Plugin (Debugger)
                        <span class="tooltip">
                            <span class="help-icon">?</span>
                            <span class="tooltiptext">
                                Choose which plugin to visualize. This selection only affects the
                                debugger panels‚Äîsession creation remains independent.
                            </span>
                        </span>
                    </label>
                    <div class="protocol-selector-row">
                        <select id="pluginDebugProtocol">
                            <option value="">Select a protocol to inspect‚Ä¶</option>
                        </select>
                        <button id="reloadPluginBtn" class="reload-btn" title="Reload current protocol plugin">
                            <span class="reload-icon">‚ü≥</span> Reload
                        </button>
                    </div>
                    <div class="field-help">Debugger data updates when you pick a protocol here.</div>
                </div>
                <div id="behaviorSummary" class="behavior-summary">
                    Select a protocol to view automatic field behaviors.
                </div>
                <div class="insight-grid">
                    <div class="insight-panel">
                        <div class="insight-panel-header">
                            <h3>Protocol Blueprint</h3>
                            <span id="protocolBlueprintMeta" class="insight-meta"></span>
                        </div>
                        <div class="protocol-legend">
                            <span><span class="legend-dot fuzzable"></span>Fuzzable</span>
                            <span><span class="legend-dot locked"></span>Locked/derived</span>
                        </div>
                        <div id="protocolDiagram" class="protocol-diagram empty-state">
                            Select a protocol to visualize its blocks.
                        </div>
                    </div>
                    <div class="insight-panel">
                        <div class="insight-panel-header">
                            <h3>Test Case Explorer</h3>
                            <span id="sampleCorpusMeta" class="insight-meta"></span>
                        </div>
                        <div class="seed-preview" id="seedSampleList">
                            Provide seeds inside your plugin to preview baseline requests.
                        </div>
                        <div class="mutation-previews" id="mutationPreviewList">
                            Select a protocol to generate sample mutation plans.
                        </div>
                    </div>
                </div>
                <div class="insight-panel state-machine-panel-full">
                    <div class="insight-panel-header">
                        <h3>Protocol State Machine</h3>
                        <span id="stateMachineMeta" class="insight-meta"></span>
                    </div>
                    <div id="stateMachinePanel" class="state-machine-panel-body empty-state">
                        Select a protocol to visualize its state model.
                    </div>
                </div>
                <div class="insight-panel coach-panel">
                    <div class="insight-panel-header">
                        <h3>Configuration Coach</h3>
                    </div>
                    <div id="configurationCoach" class="coach-checklist">
                        Fill in your target details to receive readiness feedback.
                    </div>
                </div>
            </div>
        </div>

        <!-- One-Off Test Tab -->
        <div id="oneoff-test-tab" class="tab-content">
            <div class="card">
                <h2>One-Off Test Execution</h2>
                <div class="card-description">
                    Send a single test message to your target without creating a full fuzzing session.
                    Perfect for quick validation, reproduction of specific payloads, or manual testing
                    of edge cases. Use this to verify connectivity, test custom payloads, or confirm
                    crash reproducibility.
                </div>

                <form id="oneOffTestForm" onsubmit="executeOneOffTest(event)">
                    <div class="form-group">
                        <label for="oneoffProtocol">
                            Protocol Plugin
                            <span class="tooltip">
                                <span class="help-icon">?</span>
                                <span class="tooltiptext">
                                    Select the protocol plugin that matches your target's message format.
                                    This helps with payload construction and validation.
                                </span>
                            </span>
                        </label>
                        <select id="oneoffProtocol" required>
                            <option value="">Loading protocols...</option>
                        </select>
                        <div class="field-help">Choose the protocol for message encoding</div>
                    </div>

                    <div class="form-group">
                        <label for="oneoffTargetHost">
                            Target Host
                            <span class="tooltip">
                                <span class="help-icon">?</span>
                                <span class="tooltiptext">
                                    Hostname or IP address of the target server.
                                    <br><br>
                                    <strong>Docker networking:</strong><br>
                                    ‚Ä¢ Use 'target' for SimpleTCP test server<br>
                                    ‚Ä¢ Use '172.17.0.1' (Linux) to reach host from container<br>
                                    ‚Ä¢ Use 'host.docker.internal' (Mac/Windows) to reach host
                                </span>
                            </span>
                        </label>
                        <input type="text" id="oneoffTargetHost" value="target" required>
                        <div class="field-help">Hostname or IP address</div>
                    </div>

                    <div class="form-group">
                        <label for="oneoffTargetPort">
                            Target Port
                            <span class="tooltip">
                                <span class="help-icon">?</span>
                                <span class="tooltiptext">
                                    TCP port number where your target service is listening.
                                </span>
                            </span>
                        </label>
                        <input type="number" id="oneoffTargetPort" value="9999" required min="1" max="65535">
                        <div class="field-help">Port number (1-65535)</div>
                    </div>

                    <div class="form-group">
                        <label for="oneoffPayloadFormat">
                            Payload Format
                            <span class="tooltip">
                                <span class="help-icon">?</span>
                                <span class="tooltiptext">
                                    Choose how you want to input your test payload:
                                    <br>‚Ä¢ Hex: Space-separated hex bytes (e.g., "53 54 43 50 01")
                                    <br>‚Ä¢ Base64: Base64-encoded binary data
                                    <br>‚Ä¢ Text: Raw text string (will be UTF-8 encoded)
                                </span>
                            </span>
                        </label>
                        <select id="oneoffPayloadFormat" onchange="updatePayloadPlaceholder()">
                            <option value="hex">Hex (space-separated)</option>
                            <option value="base64">Base64</option>
                            <option value="text">Text (UTF-8)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="oneoffPayload">
                            Payload
                            <span class="tooltip">
                                <span class="help-icon">?</span>
                                <span class="tooltiptext">
                                    Enter your test payload in the selected format.
                                    For SimpleTCP, a valid AUTH message in hex is:
                                    "53 54 43 50 00 00 00 05 01 48 45 4c 4c 4f"
                                </span>
                            </span>
                        </label>
                        <textarea id="oneoffPayload" rows="5" required placeholder="53 54 43 50 00 00 00 05 01 48 45 4c 4c 4f"></textarea>
                        <div class="field-help" id="oneoffPayloadHelp">
                            Enter hex bytes (space-separated). Example SimpleTCP AUTH: "53 54 43 50 00 00 00 05 01 48 45 4c 4c 4f"
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="oneoffTimeout">
                            Timeout (ms)
                            <span class="tooltip">
                                <span class="help-icon">?</span>
                                <span class="tooltiptext">
                                    Maximum time to wait for a response before considering the test timed out.
                                    Increase for slow targets or networks.
                                </span>
                            </span>
                        </label>
                        <input type="number" id="oneoffTimeout" value="5000" min="100" max="60000" step="100">
                        <div class="field-help">100-60000 ms (default: 5000)</div>
                    </div>

                    <button type="submit" class="button" id="oneoffSubmitBtn">
                        üöÄ Send Test Message
                    </button>
                </form>

                <div id="oneoffResults" style="margin-top: 30px; display: none;">
                    <h3 style="margin-bottom: 15px; color: #fff;">Test Results</h3>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="stat-card">
                            <div class="stat-label">Result</div>
                            <div class="stat-value" id="oneoffResultStatus">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Execution Time</div>
                            <div class="stat-value" id="oneoffResultTime">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Response Size</div>
                            <div class="stat-value" id="oneoffResultSize">-</div>
                        </div>
                    </div>

                    <div id="oneoffResponseSection" style="margin-top: 20px; display: none;">
                        <h4 style="margin-bottom: 10px; color: #fff;">Response Data</h4>
                        <div style="background: #2a2a2a; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                            <div style="color: #888; font-size: 0.9em; margin-bottom: 5px;">Hex:</div>
                            <pre id="oneoffResponseHex" style="font-family: monospace; font-size: 0.9em; word-break: break-all; white-space: pre-wrap; margin: 0;"></pre>
                        </div>
                        <div style="background: #2a2a2a; padding: 15px; border-radius: 4px;">
                            <div style="color: #888; font-size: 0.9em; margin-bottom: 5px;">ASCII:</div>
                            <pre id="oneoffResponseAscii" style="font-family: monospace; font-size: 0.9em; word-break: break-all; white-space: pre-wrap; margin: 0;"></pre>
                        </div>
                    </div>

                    <div id="oneoffErrorSection" style="margin-top: 20px; padding: 15px; background: #3a1a1a; border: 1px solid #d32f2f; border-radius: 4px; display: none;">
                        <h4 style="margin-bottom: 10px; color: #ff5252;">Error Details</h4>
                        <pre id="oneoffErrorText" style="font-family: monospace; font-size: 0.9em; word-break: break-all; white-space: pre-wrap; margin: 0; color: #ffcdd2;"></pre>
                    </div>

                    <div id="oneoffCrashSection" style="margin-top: 20px; padding: 15px; background: #2a1a1a; border: 1px solid #ff9800; border-radius: 4px; display: none;">
                        <h4 style="margin-bottom: 10px; color: #ffb74d;">üî• Crash Detected</h4>
                        <p style="margin-bottom: 10px;">This test case triggered a crash! Finding saved to corpus.</p>
                        <div style="color: #888;">
                            <strong>Crash Report ID:</strong> <span id="oneoffCrashId" style="font-family: monospace; color: #ffb74d;">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>Quick Reference</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <h4 style="color: #888; font-size: 0.9em; margin-bottom: 10px;">SimpleTCP Test Messages</h4>
                        <div style="font-family: monospace; font-size: 0.85em; line-height: 1.6;">
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #4caf50;">AUTH:</strong><br>
                                <span style="color: #888;">53 54 43 50 00 00 00 05 01 48 45 4c 4c 4f</span>
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #2196f3;">DATA:</strong><br>
                                <span style="color: #888;">53 54 43 50 00 00 00 04 02 54 45 53 54</span>
                            </div>
                            <div>
                                <strong style="color: #f44336;">QUIT:</strong><br>
                                <span style="color: #888;">53 54 43 50 00 00 00 00 03</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: #888; font-size: 0.9em; margin-bottom: 10px;">Use Cases</h4>
                        <ul style="font-size: 0.9em; line-height: 1.6; padding-left: 20px;">
                            <li>Quick connectivity validation</li>
                            <li>Reproduce crash-inducing payloads</li>
                            <li>Test specific edge cases manually</li>
                            <li>Verify target response format</li>
                            <li>Debug protocol parsing logic</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Case Correlation Tab -->
        <div id="correlation-tab" class="tab-content">
            <div class="card-description" style="margin-bottom: 20px;">
                <strong>Purpose:</strong> When you observe an issue on the target (crash, hang, anomaly),
                use this tool to identify which test case caused it, then replay to confirm reproducibility.
            </div>

            <!-- Session Selector -->
            <div class="card" style="margin-bottom: 20px;">
                <h2>Select Session</h2>
                <div class="form-group">
                    <label for="correlationSessionSelect">Active or Recent Session</label>
                    <select id="correlationSessionSelect" onchange="loadCorrelationSession()">
                        <option value="">-- Select a session --</option>
                    </select>
                    <div class="field-help">Choose a session to view its execution history</div>
                </div>
                <div id="correlationSessionInfo" style="margin-top: 15px; display: none;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div>
                            <strong>Protocol:</strong> <span id="corrSessionProtocol">-</span>
                        </div>
                        <div>
                            <strong>Target:</strong> <span id="corrSessionTarget">-</span>
                        </div>
                        <div>
                            <strong>Status:</strong> <span id="corrSessionStatus">-</span>
                        </div>
                        <div>
                            <strong>Total Tests:</strong> <span id="corrSessionTotal">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <!-- Time-based Search -->
                <div class="card">
                    <h2>üïí Find by Timestamp</h2>
                    <div class="card-description">
                        Find which test case was executing at a specific time.
                        <strong>Use case:</strong> "Target crashed at 10:23:45, what was running?"
                    </div>
                    <div class="form-group">
                        <label for="searchTimestamp">Timestamp (ISO 8601)</label>
                        <input type="datetime-local" id="searchTimestamp" step="1">
                        <div class="field-help">
                            Select date and time when the issue occurred
                        </div>
                    </div>
                    <button onclick="findByTimestamp()" class="button">Find Test Case</button>
                    <button onclick="setCurrentTime()" class="button" style="margin-left: 10px; background: #555;">Use Current Time</button>
                </div>

                <!-- Sequence-based Search -->
                <div class="card">
                    <h2>üî¢ Find by Sequence Number</h2>
                    <div class="card-description">
                        Retrieve a specific test case by its sequence number.
                        <strong>Use case:</strong> "Show me test case #847"
                    </div>
                    <div class="form-group">
                        <label for="searchSequence">Sequence Number</label>
                        <input type="number" id="searchSequence" min="1" placeholder="e.g., 847">
                        <div class="field-help">
                            Enter the test case number from the timeline
                        </div>
                    </div>
                    <button onclick="findBySequence()" class="button">Get Test Case</button>
                </div>
            </div>

            <!-- Time Band Replay -->
            <div class="card" style="margin-bottom: 20px;">
                <h2>‚èØÔ∏è Time Band Replay</h2>
                <div class="card-description">
                    <strong>Use case:</strong> "I saw a crash around 10:23:45, replay 10:23:40-10:23:50 slowly to identify the exact test case"
                </div>
                <div class="grid" style="grid-template-columns: 1fr 1fr 200px; gap: 15px; align-items: end;">
                    <div class="form-group">
                        <label for="replayStartTime">Start Time</label>
                        <input type="datetime-local" id="replayStartTime" step="1">
                    </div>
                    <div class="form-group">
                        <label for="replayEndTime">End Time</label>
                        <input type="datetime-local" id="replayEndTime" step="1">
                    </div>
                    <div class="form-group">
                        <label for="replayDelay">Delay (ms)</label>
                        <input type="number" id="replayDelay" value="500" min="0" max="10000" step="100">
                    </div>
                </div>
                <button onclick="replayTimeRange()" class="button" style="margin-top: 10px;">
                    ‚ñ∂Ô∏è Replay Time Range
                </button>
                <div id="replayProgress" style="margin-top: 10px; display: none;">
                    <div class="progress-bar" style="background: #333; height: 20px; border-radius: 4px; overflow: hidden;">
                        <div id="replayProgressBar" style="background: #4caf50; height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    <div style="margin-top: 5px; color: #888;">
                        <span id="replayProgressText">Replaying...</span>
                    </div>
                </div>
            </div>

            <!-- Timeline View -->
            <div class="card">
                <h2>üìã Execution Timeline</h2>
                <div class="card-description">
                    Recent test case executions (auto-updates every 2s when session is running)
                </div>
                <div style="margin-bottom: 15px;">
                    <label>
                        <input type="checkbox" id="autoRefreshTimeline" checked>
                        Auto-refresh (2s interval)
                    </label>
                    <button onclick="refreshTimeline()" class="button" style="margin-left: 15px; padding: 5px 15px;">
                        ‚ü≥ Refresh Now
                    </button>
                    <span style="margin-left: 15px; color: #888;">
                        Showing last <span id="timelineCount">0</span> executions
                    </span>
                </div>
                <div style="overflow-x: auto;">
                    <table id="timelineTable" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #2a2a2a; text-align: left;">
                                <th style="padding: 10px; border-bottom: 2px solid #444;">#</th>
                                <th style="padding: 10px; border-bottom: 2px solid #444;">Time Sent</th>
                                <th style="padding: 10px; border-bottom: 2px solid #444;">Message Type</th>
                                <th style="padding: 10px; border-bottom: 2px solid #444;">State</th>
                                <th style="padding: 10px; border-bottom: 2px solid #444;">Result</th>
                                <th style="padding: 10px; border-bottom: 2px solid #444;">Duration (ms)</th>
                                <th style="padding: 10px; border-bottom: 2px solid #444;">Payload Size</th>
                                <th style="padding: 10px; border-bottom: 2px solid #444;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="timelineBody">
                            <tr>
                                <td colspan="8" style="padding: 20px; text-align: center; color: #888;">
                                    Select a session to view execution history
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Detail View Modal -->
            <div id="executionDetailModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto; padding: 40px;">
                <div style="max-width: 900px; margin: 0 auto; background: #1e1e1e; border-radius: 8px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">Test Case Details</h2>
                        <button onclick="closeDetailModal()" style="background: #555; border: none; color: white; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 16px;">‚úï Close</button>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <strong>Sequence Number:</strong> #<span id="detailSequence">-</span>
                        </div>
                        <div>
                            <strong>Test Case ID:</strong> <span id="detailId" style="font-family: monospace; font-size: 0.9em;">-</span>
                        </div>
                        <div>
                            <strong>Time Sent:</strong> <span id="detailTimeSent">-</span>
                        </div>
                        <div>
                            <strong>Time Response:</strong> <span id="detailTimeResponse">-</span>
                        </div>
                        <div>
                            <strong>Duration:</strong> <span id="detailDuration">-</span> ms
                        </div>
                        <div>
                            <strong>Result:</strong> <span id="detailResult" class="badge">-</span>
                        </div>
                        <div>
                            <strong>Protocol:</strong> <span id="detailProtocol">-</span>
                        </div>
                        <div>
                            <strong>Message Type:</strong> <span id="detailMessageType">-</span>
                        </div>
                        <div>
                            <strong>State at Send:</strong> <span id="detailState">-</span>
                        </div>
                        <div>
                            <strong>Payload Hash:</strong> <span id="detailHash" style="font-family: monospace; font-size: 0.85em; word-break: break-all;">-</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 10px;">Payload Preview (first 64 bytes)</h3>
                        <div id="detailPayloadPreview" style="background: #2a2a2a; padding: 15px; border-radius: 4px; font-family: monospace; word-break: break-all; font-size: 0.9em;">
                            -
                        </div>
                        <div style="margin-top: 5px; color: #888; font-size: 0.9em;">
                            Total size: <span id="detailPayloadSize">-</span> bytes
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;" id="detailResponseSection">
                        <h3 style="margin-bottom: 10px;">Response Preview (first 64 bytes)</h3>
                        <div id="detailResponsePreview" style="background: #2a2a2a; padding: 15px; border-radius: 4px; font-family: monospace; word-break: break-all; font-size: 0.9em;">
                            -
                        </div>
                        <div style="margin-top: 5px; color: #888; font-size: 0.9em;">
                            Total size: <span id="detailResponseSize">-</span> bytes
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 10px;">Full Payload (Base64)</h3>
                        <textarea id="detailFullPayload" readonly style="width: 100%; height: 120px; background: #2a2a2a; border: 1px solid #444; color: #ddd; padding: 10px; font-family: monospace; font-size: 0.85em; resize: vertical;"></textarea>
                        <button onclick="copyFullPayload()" class="button" style="margin-top: 10px;">
                            üìã Copy to Clipboard
                        </button>
                    </div>

                    <div style="padding: 15px; background: #2a2a2a; border-radius: 4px; text-align: center;">
                        <button onclick="replaySingleTestCase()" class="button" style="font-size: 16px; padding: 12px 30px;">
                            ‚ñ∂Ô∏è Replay This Test Case
                        </button>
                        <div style="margin-top: 10px; color: #888; font-size: 0.9em;">
                            Re-sends this exact payload to the target to confirm reproducibility
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Help & Documentation</h2>
                <button class="modal-close" onclick="closeHelp()">√ó</button>
            </div>
            <div>
                <h3 style="color: #93c5fd; margin-bottom: 15px;">Quick Links</h3>
                <ul class="modal-link-list">
                    <li><a href="/guides/getting-started.html" target="_blank">Getting Started Overview</a></li>
                    <li><a href="/guides/protocol-authoring-guide.html" target="_blank">Protocol Authoring Guide</a></li>
                    <li><a href="/guides/mutation-guide.html" target="_blank">Mutation Strategy Reference</a></li>
                </ul>

                <h3 style="color: #0066cc; margin-top: 30px; margin-bottom: 15px;">External Documentation</h3>
                <ul style="margin-left: 20px; line-height: 2; color: #aaa;">
                    <li><code>QUICKSTART.md</code> - Setup and deployment guide</li>
                    <li><code>CHEATSHEET.md</code> - Quick reference for commands</li>
                    <li><code>blueprint.md</code> - Architecture and design</li>
                    <li><code>roadmap.md</code> - Development phases</li>
                </ul>

                <h3 style="color: #0066cc; margin-top: 30px; margin-bottom: 15px;">Support</h3>
                <p style="color: #aaa; margin-bottom: 10px;">
                    Check Docker logs for debugging:
                </p>
                <div class="code-block">
                    <pre># View all services
docker-compose logs -f

# View specific service
docker-compose logs -f core
docker-compose logs -f target</pre>
                </div>
            </div>
        </div>
    </div>

    <script defer src="/ui-static/ui.js"></script>

</body>
</html>
